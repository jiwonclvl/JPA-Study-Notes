# Chapter8 값 타입

<br>

# 목차

> **[1. 기본값 타입](#기본값-타입)**
>
> **[2. 임베디드 타입(복합 값 타입)](#임베디드-타입복합-값-타입)**
>
> **[3. 값 타입과 불변 객체](#값-타입과-불변-객체)**
>
> **[4. 값 타입의 비교](#값-타입의-비교)**
>
> **[5. 값 타입 컬렉션](#값-타입-컬렉션)**

<br>

## JPA의 데이터 타입을 크게 분류하면 엔티티 타입과 값 타입으로 나눌 수 있다. 

### 엔티티 타입: @Entity로 정의하는 객체 
➡️ 식별자로 추적하기 때문에 이름, 키 등의 값이 변경되어도 같은 엔티티로 인식

<br>


### 값 타입: int, Integer, String 처럼 단순리 값으로 사용하는 타입

➡️ 값 변경 시 완전히 다른 값으로 대체된다. 

값 타입은 아래와 같이 3가지로 나눌 수 있다. 

- 기본값 타입

  - 자바 기본 타입 (int, double.. 등) 
  - 래퍼 클래스 (Integer.. 등)
  - String


- 임베디드 타입 


- 컬렉션 값 타입

## 기본값 타입

🚨 `기본 타입(Primitive type)`은 **절대 공유되지 않는다.** 

<br>

## 임베디드 타입(복합 값 타입)

새로운 값 타입을 직접 정의해서 사용하는 타입

```java
@Entity
public class Member {
    @Id
    @GeneratedValue
    private Long id;

    @Enbedded
    private Period workPerid; //Period 임베디드 타입

    @Enbedded
    private Address homeAddress; //Address 임베디드 타입
}
```

```java
@Embeddable
public class Period {
    // 기간에 관련된 상세 정보들
}
```

```java
@Embeddable
public class Address {
    //주소에 관련된 상세 정보들
}
```

**새로 정의한 값 타입들은 재사용할 수 있고 응집도도 높다.** 

> **💡 어노테이션**
> - @Enbedded: 값 타입을 사용하는 곳에 표시 
> - @Embeddable: 값 타입을 정의하는 곳에 표시
> 
> ➡️ 둘 중 하나만 사용해도 된다. 
> 
> **🚨 임베디드 타입은 기본 생성자가 필수이다.** 

<br>

엔티티와 임베디드 타입의 관계를 UML로 표현하면 `컴포지션 관계(Composition)`가된다. 

![Image](https://github.com/user-attachments/assets/1ed9b68c-b4b2-4640-a61a-81247b9fc2c2)

### 임베디드 타입과 테이블 매핑 

`임배디드 타입`은 <ins>엔티티의 값</ins>을 뿐이다. ➡️ 따라서, **엔티티의 테이블에 매핑**한다. 

> 💡 잘 설계한 ORM 애플리케이션은 매핑한 테이블의 수보다 클래스의 수가 더 많다. 

<br>

> 🔎 임베디드 타입이 null이면 해당 타입 내의 필드들은 모두 null이 된다. 

<br>

## 값 타입과 불변 객체

### 값 타입 공유 참조

 🚨 임베디드 타입 같은 값 타입을 여러 엔티티에서 공유하면 위험하다. 
 
➡️ 여러 엔티티가 동일한 인스터스의 임베디드 타입을 가지기 때문에 변경될 경우 예상치 못하게 다른 엔티티에 변화가 생길 수 있다. 

위와 같은 문제를 막기 위해서는 값 타입을 복사해서 사용한다. 


<br>

### 값 타입 복사

객체 타입의 경우 값을 대입하면 항상 참조 값을 전달한다. 따라서 `.clone()`과 같이 깊은 복사를 해야한다. 

> 💡 **.clone():** 자신을 복사해서 반환한다. 


➡️ 값 타입은 부작용 없이 사용할 수 있어야한다. 따라서, **될 수 있으면 불변 객체로 설계**해야한다. **⭕ 수정자 메서드 제거**

**[대표적인 불변 객체]**

- String
- Integer

<br>

## 값 타입의 비교

- 2개의 정보가 완전히 같은 것 ➡︎ **동일성(Identity)** : `== 연산자 사용`
- 동일한 정보를 담고 있는 것 ➡ **︎동등성(equality)** : `equals() 메서드 사용` ➡️ 값 타입 비교 시 사용

<br>

## 값 타입 컬렉션

JPA 구현체에서는 **값 타입 컬렉션에 변경 사항이 발생**하면 값 타입 컬렉션이 매핑된 테이블에 연관된 **모든 데이터를 삭제**하고 컬렉션에 있는 **모든 값을 다시 저장**한다.  

### 실무에서는 값 타입 컬렉션이 매핑된 테이블에 데이터가 많을 경우 일대다 관계를 고려해야한다. 

➡️ `영속성 전이 + 고아 객체 제거 적용 시` 값 타입 컬렉션 처럼 사용 가능